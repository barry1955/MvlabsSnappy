<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Mvlabssnappy : MvlabsSnappy is a ZF2 module that allow easy to thumbnail, snapshot or PDF generation from a url or a html page using Snappy PHP (5.3+) wrapper for the wkhtmltopdf/wkhtmltoimage conversion utility.">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Mvlabssnappy</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/mvlabs/MvlabsSnappy">View on GitHub</a>

          <h1 id="project_title">Mvlabssnappy</h1>
          <h2 id="project_tagline">MvlabsSnappy is a ZF2 module that allow easy to thumbnail, snapshot or PDF generation from a url or a html page using Snappy PHP (5.3+) wrapper for the wkhtmltopdf/wkhtmltoimage conversion utility.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/mvlabs/MvlabsSnappy/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/mvlabs/MvlabsSnappy/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="mvlabssnappy" class="anchor" href="#mvlabssnappy"><span class="octicon octicon-link"></span></a>MvlabsSnappy</h1>

<p>MvlabsSnappy is a ZF2 module that allow easy to thumbnail, snapshot or PDF generation from a url or a html page using Snappy PHP (5.3+) wrapper for the <a href="http://code.google.com/p/wkhtmltopdf/">wkhtmltopdf</a> conversion utility.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<h4>
<a name="with-composer" class="anchor" href="#with-composer"><span class="octicon octicon-link"></span></a>With composer</h4>

<ol>
<li>
<p>Add to your <code>composer.json</code>:</p>

<div class="highlight highlight-json"><pre><span class="s2">"require"</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">"mvlabs/mvlabs-snappy"</span><span class="p">:</span> <span class="s2">"dev-master"</span>
<span class="p">}</span>
</pre></div>
</li>
<li>
<p>Now tell composer to download MvlabsSnappy by running the command:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>php composer.phar update
</pre></div>
</li>
</ol>

<h4>
<a name="or-just-clone-the-repos" class="anchor" href="#or-just-clone-the-repos"><span class="octicon octicon-link"></span></a>Or just clone the repos:</h4>

<pre><code># Install snappy library
git clone https://github.com/KnpLabs/snappy.git vendor/snappy

# Install ZF2 Module
git clone https://github.com/mvlabs/MvlabsSnappy.git vendor/mvlabs/mvlabs-snappy
</code></pre>

<h4>
<a name="post-installation" class="anchor" href="#post-installation"><span class="octicon octicon-link"></span></a>Post installation</h4>

<ol>
<li>
<p>Enabling it in your <code>application.config.php</code>file.</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'modules'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="c1">// ...</span>
        <span class="s1">'MvlabsSnappy'</span><span class="p">,</span>            
    <span class="p">),</span>
    <span class="c1">// ...</span>
<span class="p">);</span>
</pre></div>
</li>
</ol>

<h2>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>After installing MvlabsSnappy, copy
<code>./vendor/mvlabs/MvlabsSnappy/config/mvlabs-snappy.local.php.dist</code> to
<code>./config/autoload/mvlabs-snappy.local.php</code> and change the binaries path  and add options as desired.</p>

<pre><code># /config/autoload/mvlabs-snappy.local.php
</code></pre>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">return</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'mvlabs-snappy'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'pdf'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
           <span class="s1">'binary'</span>  <span class="o">=&gt;</span> <span class="s1">'/usr/local/bin/wkhtmltopdf'</span><span class="p">,</span>
           <span class="s1">'options'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span> <span class="c1">// Type wkhtmltopdf -H to see the list of options</span>
        <span class="p">),</span>   
        <span class="s1">'image'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'binary'</span>  <span class="o">=&gt;</span> <span class="s1">'/usr/local/bin/wkhtmltoimage'</span><span class="p">,</span>
            <span class="s1">'options'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span> <span class="c1">// Type wkhtmltoimage -H to see the list of options</span>
         <span class="p">)</span>
     <span class="p">)</span>   
<span class="p">);</span>
</pre></div>

<h2>
<a name="wkhtmltopdf-binary-as-composer-dependencies" class="anchor" href="#wkhtmltopdf-binary-as-composer-dependencies"><span class="octicon octicon-link"></span></a>wkhtmltopdf binary as composer dependencies</h2>

<p>If you want to download wkhtmltopdf with composer you add to <code>composer.json</code>:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"require"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"google/wkhtmltopdf-i386"</span><span class="p">:</span> <span class="s2">"0.11.0-RC1"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>or this if you are in 64 bit based system:</p>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"require"</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">"google/wkhtmltopdf-amd64"</span><span class="p">:</span> <span class="s2">"0.11.0-RC1"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>NOTE</strong>: to be able to use those custom defined packages you need to copy into your <code>composer.json</code> following code:</p>
</blockquote>

<div class="highlight highlight-json"><pre><span class="p">{</span>
    <span class="nt">"repositories"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"package"</span><span class="p">,</span>
            <span class="nt">"package"</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"google/wkhtmltopdf-amd64"</span><span class="p">,</span>
                <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"0.11.0-RC1"</span><span class="p">,</span>
                <span class="nt">"dist"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"http://wkhtmltopdf.googlecode.com/files/wkhtmltopdf-0.11.0_rc1-static-amd64.tar.bz2"</span><span class="p">,</span>
                    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"tar"</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"package"</span><span class="p">,</span>
            <span class="nt">"package"</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">"name"</span><span class="p">:</span> <span class="s2">"google/wkhtmltopdf-i386"</span><span class="p">,</span>
                <span class="nt">"version"</span><span class="p">:</span> <span class="s2">"0.11.0-RC1"</span><span class="p">,</span>
                <span class="nt">"dist"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">"url"</span><span class="p">:</span> <span class="s2">"http://wkhtmltopdf.googlecode.com/files/wkhtmltopdf-0.11.0_rc1-static-i386.tar.bz2"</span><span class="p">,</span>
                    <span class="nt">"type"</span><span class="p">:</span> <span class="s2">"tar"</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>The module registers two services:  </p>

<ul>
<li>the <code>mvlabssnappy.image.service</code> service allows you to generate images;</li>
<li>the <code>mvlabssnappy.pdf.service</code> service allows you to generate pdf files.</li>
</ul>

<h3>
<a name="generate-an-image-from-an-url" class="anchor" href="#generate-an-image-from-an-url"><span class="octicon octicon-link"></span></a>Generate an image from an URL</h3>

<pre><code> $this-&gt;serviceLocator-&gt;get('mvlabssnappy.image.service')-&gt;generate('http://www.mvlabs.it', '/path/to/myapp/data/image.jpg');
</code></pre>

<h3>
<a name="generate-a-pdf-document-from-an-url" class="anchor" href="#generate-a-pdf-document-from-an-url"><span class="octicon octicon-link"></span></a>Generate a pdf document from an URL</h3>

<pre><code> $this-&gt;serviceLocator-&gt;get('mvlabssnappy.pdf.service')-&gt;generate('http://www.mvlabs.it', '/path/to/myapp/data/document.pdf');
</code></pre>

<h3>
<a name="render-a-pdf-document-as-response-from-a-controller" class="anchor" href="#render-a-pdf-document-as-response-from-a-controller"><span class="octicon octicon-link"></span></a>Render a pdf document as response from a controller</h3>

<div class="highlight highlight-php"><pre>    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPdfAction</span><span class="p">()</span> <span class="p">{</span>

        <span class="nv">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">();</span>
        <span class="nv">$viewRenderer</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'view_manager'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getRenderer</span><span class="p">();</span>

        <span class="nv">$layoutViewModel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">layout</span><span class="p">();</span>
        <span class="nv">$layoutViewModel</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">'layout/pdf-layout'</span><span class="p">);</span>

        <span class="nv">$viewModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ViewModel</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">'vars'</span> <span class="o">=&gt;</span> <span class="nv">$vars</span><span class="p">,</span>            
        <span class="p">));</span>

        <span class="nv">$viewModel</span><span class="o">-&gt;</span><span class="na">setTemplate</span><span class="p">(</span><span class="s1">'myModule/myController/pdf-template'</span><span class="p">);</span>

        <span class="nv">$layoutViewModel</span><span class="o">-&gt;</span><span class="na">setVariables</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="nv">$viewRenderer</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="nv">$viewModel</span><span class="p">),</span>
        <span class="p">));</span>

        <span class="nv">$htmlOutput</span> <span class="o">=</span> <span class="nv">$viewRenderer</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="nv">$layoutViewModel</span><span class="p">);</span>

        <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceLocator</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'mvlabssnappy.pdf.service'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getOutputFromHtml</span><span class="p">(</span><span class="nv">$htmlOutput</span><span class="p">);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>
        <span class="nv">$headers</span>  <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getHeaders</span><span class="p">();</span>
        <span class="nv">$headers</span><span class="o">-&gt;</span><span class="na">addHeaderLine</span><span class="p">(</span><span class="s1">'Content-Type'</span><span class="p">,</span> <span class="s1">'application/pdf'</span><span class="p">);</span>
        <span class="nv">$headers</span><span class="o">-&gt;</span><span class="na">addHeaderLine</span><span class="p">(</span><span class="s1">'Content-Disposition'</span><span class="p">,</span> <span class="s2">"attachment; filename=</span><span class="se">\"</span><span class="s2">export-"</span> <span class="o">.</span> <span class="nv">$now</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">'d-m-Y H:i:s'</span><span class="p">)</span> <span class="o">.</span> <span class="s2">".pdf</span><span class="se">\"</span><span class="s2">"</span><span class="p">);</span>

        <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$output</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>

    <span class="p">}</span>    
</pre></div>

<h2>
<a name="credits" class="anchor" href="#credits"><span class="octicon octicon-link"></span></a>Credits</h2>

<p>MvlabsSnappy and <a href="https://github.com/KnpLabs/snappy">Snappy</a> are based on the awesome <a href="http://code.google.com/p/wkhtmltopdf/">wkhtmltopdf</a>.
MvlabsSnappy has been developed by <a href="http://www.mvlabs.it">mvlabs</a>.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Mvlabssnappy maintained by <a href="https://github.com/mvlabs">mvlabs</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
